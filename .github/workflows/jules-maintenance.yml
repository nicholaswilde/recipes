name: Jules Maintenance

on:
  schedule:
    - cron: '0 0 * * 1'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  maintenance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Invoke Jules
        if: ${{ contains(fromJSON('["trusted-user", "another-user"]'), github.event.issue.user.login) }}
        uses: google-labs-code/jules-action/jules-invoke@v1
        with:
          jules_api_key: ${{ secrets.JULES_API_KEY }}
          prompt: |
            1. Optimize images in the repository that are larger than 500KB.
            2. Resize them to a maximum width of 1920px maintaining aspect ratio.
            3. If file extensions change (e.g. to .webp), update references in .md files.
            4. Validate all image links in Markdown files and flag broken ones.
            5. Generate a Markdown table in the PR description showing "Before" vs "After" file sizes and savings percentages.
